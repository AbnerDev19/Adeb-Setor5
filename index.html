<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Agenda ADEB Missão</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>

    <link rel="stylesheet" href="css/style.css">
    <link rel="icon" type="image/png" href="fotos/logo1.png" />
</head>

<body>

    <div class="card-nav-container">
        <nav class="card-nav">
            <div class="card-nav-top">
                <div class="hamburger-menu" role="button" tabindex="0" aria-label="Toggle menu">
                    <div class="hamburger-line"></div>
                    <div class="hamburger-line"></div>
                </div>

                <div class="logo-container">
                    <img src="fotos/logo1.png" alt="ADEB Missão" class="logo">
                </div>

                <button type="button" class="card-nav-cta-button" id="btnLogin">
                    <i class="fas fa-user-shield"></i> <span id="loginText">Líder</span>
                </button>
            </div>

            <div class="card-nav-content">
                <div class="nav-card" style="background-color: #0f4c81; color: #fff;">
                    <div class="nav-card-label">Navegação</div>
                    <div class="nav-card-links">
                        <a href="index.html" class="nav-card-link">
                            <i class="fas fa-calendar-alt"></i> Calendário Geral
                        </a>
                        <a href="jovens-adolescentes.html" class="nav-card-link" id="linkJovens" style="display: none;">
                            <i class="fas fa-users"></i> Jovens e Adolescentes
                        </a>
                        <a href="escola-biblica.html" class="nav-card-link" id="linkEBD" style="display: none;">
                            <i class="fas fa-book-open"></i> Escola Bíblica
                        </a>
                    </div>
                </div>

                <div class="nav-card" style="background-color: #1e293b; color: #fff;">
                    <div class="nav-card-label">Atalhos</div>
                    <div class="nav-card-links">
                        <a href="#" class="nav-card-link"
                            onclick="document.querySelector('.filters-bar').scrollIntoView({behavior: 'smooth'})">
                            <i class="fas fa-filter"></i> Filtrar Eventos
                        </a>
                        <a href="#" class="nav-card-link">
                            <i class="fas fa-map-marker-alt"></i> Localizar Igrejas
                        </a>
                    </div>
                </div>
            </div>
        </nav>
    </div>

    <main class="main-content">
        <button onclick="window.carregarDados()" style="position:fixed; bottom:20px; right:20px; z-index:9999; padding:20px; background:red; color:white; font-weight:bold; border:none; border-radius:10px; cursor:pointer;">
    ⚠️ CARGAR DADOS (ADMIN)
</button>
        <div class="header-title">
            <h1>Agenda 2026</h1>
            <p>Acompanhe os próximos cultos e eventos do ministério.</p>
        </div>

        <div class="filters-bar"
            style="background: white; padding: 20px; border-radius: 16px; display: flex; gap: 15px; box-shadow: var(--shadow-sm); flex-wrap: wrap;">
            <div style="display: flex; align-items: center; gap: 10px; color: var(--text-secondary); font-weight: 600;">
                <i class="fas fa-filter"></i>
                <span>Filtrar:</span>
            </div>
            <select id="filterDept" class="input-group" style="flex:1; margin:0;">
                <option value="" selected>Todos os Departamentos</option>
                <option value="Jovens">Jovens</option>
                <option value="Adolescentes">Adolescentes</option>
                <option value="Varões">Varões</option>
                <option value="Irmãs">Irmãs</option>
                <option value="Crianças">Crianças</option>
                <option value="Geral">Geral / Família</option>
            </select>
            <select id="filterIgreja" class="input-group" style="flex:1; margin:0;">
                <option value="" selected>Todas as Igrejas</option>
                <option value="Sede">Sede do Setor 05</option>
                <option value="GUARÁ II">GUARÁ II</option>
                <option value="GUARÁ I">GUARÁ I</option>
                <option value="LÚCIO COSTA">LÚCIO COSTA</option>
                <option value="VILA CAHUY">VILA CAHUY</option>
                <option value="VARGEM BONITA">VARGEM BONITA</option>
                <option value="QUADRA 13">QUADRA 13</option>
                <option value="VEREDA GRANDE">VEREDA GRANDE</option>
                <option value="CANDANGOLÂNDIA">CANDANGOLÂNDIA</option>
            </select>
            <button id="btnClearFilters" class="btn-clear" style="background: #fee2e2; color: #ef4444;">
                <i class="fas fa-times"></i>
            </button>
        </div>

        <div class="dashboard-grid">
            <div class="card">
                <div class="calendar-header">
                    <button class="nav-arrow" id="prevMonth"><i class="fas fa-chevron-left"></i></button>
                    <h2 id="monthYear">Carregando...</h2>
                    <button class="nav-arrow" id="nextMonth"><i class="fas fa-chevron-right"></i></button>
                </div>
                <div class="weekdays"
                    style="display: grid; grid-template-columns: repeat(7, 1fr); text-align: center; font-weight: 600; color: var(--text-secondary); margin-bottom: 10px; font-size: 0.8rem;">
                    <div>D</div>
                    <div>S</div>
                    <div>T</div>
                    <div>Q</div>
                    <div>Q</div>
                    <div>S</div>
                    <div>S</div>
                </div>
                <div class="days-grid" id="daysContainer"></div>
            </div>

            <div class="card">
                <h3 class="card-title" style="color: var(--accent-color); margin-bottom: 20px;">Próximos Eventos</h3>
                <div id="eventsList" class="events-container"></div>
            </div>
        </div>

        <section id="admin-section"
            style="display: none; background: white; padding: 30px; border-radius: 16px; margin-top: 30px; box-shadow: var(--shadow-lg);">
            <div id="login-form-container">
                <div class="admin-header" style="text-align: center; margin-bottom: 20px;">
                    <h3><i class="fas fa-lock"></i> Acesso Restrito</h3>
                </div>
                <div class="admin-form"
                    style="max-width: 400px; margin: 0 auto; display: flex; flex-direction: column; gap: 15px;">
                    <div class="input-group">
                        <label>E-mail</label>
                        <input type="email" id="loginEmail" placeholder="admin@adeb.com">
                    </div>
                    <div class="input-group">
                        <label>Senha</label>
                        <input type="password" id="loginPass" placeholder="******">
                    </div>
                    <button class="btn-add" id="btnLoginPass"
                        style="background: var(--accent-color); color: white;">Entrar</button>
                    <p id="loginError" style="color: #ff3b30; font-size: 0.8rem; display: none; text-align: center;">
                    </p>

                    <div style="display: flex; align-items: center; gap: 10px; color: #cbd5e1; margin: 10px 0;">
                        <div style="flex: 1; height: 1px; background: #e2e8f0;"></div><span>OU</span>
                        <div style="flex: 1; height: 1px; background: #e2e8f0;"></div>
                    </div>

                    <button id="btnLoginGoogle" class="btn-add"
                        style="background: white; color: #333; border: 1px solid #e2e8f0;">
                        <img src="fotos/logo2.png" alt="G" style="width: 18px;"> Entrar com Google
                    </button>
                </div>
            </div>

            <div id="event-form-container" style="display: none;">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                    <h3><i class="fas fa-plus-circle"></i> Novo Evento</h3>
                    <div style="display: flex; gap: 10px; align-items: center;">
                        <span
                            style="font-size: 0.75rem; background: #dcfce7; color: #166534; padding: 4px 8px; border-radius: 12px;">Logado</span>
                        <button id="btnLogout"
                            style="background:none; border:none; color: #ef4444; cursor:pointer; font-weight: 600;">Sair</button>
                    </div>
                </div>

                <div class="admin-form dashboard-grid">
                    <div class="input-group">
                        <label>Departamento</label>
                        <select id="evtDept">
                            <option value="" disabled selected>Selecione...</option>
                            <option value="Geral">Geral / Família</option>
                            <option value="Jovens">Jovens</option>
                            <option value="Adolescentes">Adolescentes</option>
                            <option value="Varões">Varões</option>
                            <option value="Irmãs">Irmãs</option>
                            <option value="Crianças">Crianças</option>
                        </select>
                    </div>
                    <div class="input-group">
                        <label>Tipo</label>
                        <select id="tipoEvento">
                            <option value="" disabled selected>Selecione...</option>
                            <option value="local">Local</option>
                            <option value="setorial">Setorial</option>
                            <option value="geral">Geral</option>
                        </select>
                    </div>
                    <div class="input-group" id="divSelectIgreja">
                        <label>Igreja</label>
                        <select id="selectIgreja">
                            <option value="" disabled selected>Selecione...</option>
                            <option value="Sede do Setor 05">Sede do Setor 05</option>
                            <option value="GUARÁ II">GUARÁ II</option>
                            <option value="GUARÁ I">GUARÁ I</option>
                            <option value="LÚCIO COSTA">LÚCIO COSTA</option>
                            <option value="VILA CAHUY">VILA CAHUY</option>
                            <option value="VARGEM BONITA">VARGEM BONITA</option>
                            <option value="QUADRA 13">QUADRA 13</option>
                            <option value="VEREDA GRANDE">VEREDA GRANDE</option>
                            <option value="CANDANGOLÂNDIA">CANDANGOLÂNDIA</option>
                        </select>
                    </div>
                    <div class="input-group">
                        <label>Título</label>
                        <input type="text" id="evtTitle" placeholder="Ex: Culto de Missões">
                    </div>
                    <div class="input-group">
                        <label>Data</label>
                        <input type="date" id="evtDate">
                    </div>
                    <div class="input-group">
                        <label>Detalhes (Horário/Local)</label>
                        <input type="text" id="evtLoc" placeholder="19h30 - Templo Principal">
                    </div>
                </div>
                <button class="btn-add" id="btnSaveEvent"
                    style="width: 100%; margin-top: 20px; background: var(--accent-color); color: white;">Salvar
                    Evento</button>
            </div>
        </section>
    </main>

    <script type="module" src="js/firebase-config.js"></script>
    <script type="module" src="js/app.js"></script>
    <script type="module" src="js/admin.js"></script>
    <script type="module" src="js/carga-dados.js"></script>
    <script type="module" src="js/script.js"></script>

    <div style="position:fixed; bottom:20px; right:20px; z-index:9999;">
    <button onclick="window.executarCarga()" style="padding:15px 25px; background:#ef4444; color:white; font-weight:bold; border:none; border-radius:12px; box-shadow: 0 10px 15px -3px rgba(0,0,0,0.1); cursor:pointer; font-family:sans-serif;">
        ⚠️ CARREGAR BANCO DE DADOS
    </button>
</div>

<script type="module">
    // Importação ajustada para rodar direto do index.html
    import { db, collection, addDoc, getDocs, deleteDoc, writeBatch, doc } from './js/firebase-config.js';

    // 1. DADOS DO PDF + REGRA DE NEGÓCIO
    const eventosPDF = [
        // JANEIRO
        { date: '2026-01-19', title: 'Aniversário Pr. Eraldo', loc: 'Candangolândia', type: 'setorial', dept: 'Geral' },
        // FEVEREIRO
        { date: '2026-02-21', title: 'Aniversário Pr. Orcival Pereira Xavier', loc: 'Sede', type: 'geral', dept: 'Geral' },
        // MARÇO
        { date: '2026-03-07', title: 'Dia Internacional da Mulher', loc: 'Guará I', type: 'setorial', dept: 'Irmãs' },
        { date: '2026-03-08', title: 'Aniversário Pr. Francisco', loc: 'Vereda Grande', type: 'setorial', dept: 'Geral' },
        { date: '2026-03-14', title: 'Festival Primavera', loc: 'Núcleo Bandeirante', type: 'setorial', dept: 'Geral' },
        { date: '2026-03-15', title: 'Festival Primavera (Enc)', loc: 'Núcleo Bandeirante', type: 'setorial', dept: 'Geral' },
        { date: '2026-03-26', title: 'Festividade Adolescentes (Cj. Cálamo)', loc: 'Núcleo Bandeirante', type: 'setorial', dept: 'Adolescentes' },
        { date: '2026-03-27', title: 'Festividade Jovens (Cj. Alfa)', loc: 'Núcleo Bandeirante', type: 'setorial', dept: 'Jovens' },
        { date: '2026-03-28', title: 'Festividade Irmãs (Louvor Celeste)', loc: 'Núcleo Bandeirante', type: 'setorial', dept: 'Irmãs' },
        // MAIO
        { date: '2026-05-01', title: 'Evangelismo', loc: 'Vargem Bonita', type: 'setorial', dept: 'Geral' },
        { date: '2026-05-09', title: 'Festividade UCADEB', loc: 'Lúcio Costa', type: 'setorial', dept: 'Crianças' },
        { date: '2026-05-16', title: 'Pré-Congresso UNAADEB', loc: 'Sede', type: 'geral', dept: 'Adolescentes' },
        { date: '2026-05-17', title: 'Aniversário Pb. Ivanilton', loc: 'Park Way', type: 'setorial', dept: 'Geral' },
        { date: '2026-05-18', title: 'Aniversário Pb. Luis Carlos', loc: 'Vila Cahuy', type: 'setorial', dept: 'Geral' },
        { date: '2026-05-22', title: 'Festividade Adolescentes', loc: 'Guará I', type: 'setorial', dept: 'Adolescentes' },
        { date: '2026-05-23', title: 'Festividade Adolescentes (Enc)', loc: 'Guará I', type: 'setorial', dept: 'Adolescentes' },
        { date: '2026-05-30', title: 'Aniversário Coral Maranata', loc: 'Sede', type: 'setorial', dept: 'Geral' },
        // JUNHO
        { date: '2026-06-14', title: 'Aniversário Pr. Carlos Alencar', loc: 'Guará II', type: 'setorial', dept: 'Geral' },
        { date: '2026-06-18', title: 'Festividade Varões', loc: 'Lúcio Costa', type: 'setorial', dept: 'Varões' },
        { date: '2026-06-19', title: 'Festividade Jovens e Adolescentes', loc: 'Lúcio Costa', type: 'setorial', dept: 'Jovens' },
        { date: '2026-06-20', title: 'Festividade Irmãs', loc: 'Lúcio Costa', type: 'setorial', dept: 'Irmãs' },
        { date: '2026-06-27', title: 'Festa dos Estados', loc: 'Guará I', type: 'setorial', dept: 'Geral' },
        { date: '2026-06-28', title: 'Festa dos Estados (Enc)', loc: 'Guará I', type: 'setorial', dept: 'Geral' },
        // JULHO
        { date: '2026-07-04', title: 'Pré-Congresso UFADEB', loc: 'Sede', type: 'geral', dept: 'Irmãs' },
        { date: '2026-07-09', title: 'Aniversário Pr. Silva', loc: 'Guará I', type: 'setorial', dept: 'Geral' },
        { date: '2026-07-12', title: 'Aniversário Pr. Izacc', loc: 'Paraíba', type: 'setorial', dept: 'Geral' },
        { date: '2026-07-17', title: 'Retiro UMADEB (Início)', loc: 'Externo', type: 'geral', dept: 'Jovens' },
        { date: '2026-07-25', title: 'Festividade UCADEB', loc: 'Candangolândia', type: 'setorial', dept: 'Crianças' },
        { date: '2026-07-25', title: 'Aniversário Pr. Saul Tavares (Coord)', loc: 'Candangolândia', type: 'setorial', dept: 'Geral' },
        // AGOSTO
        { date: '2026-08-01', title: 'Festividade Jovens e Adolescentes', loc: 'Candangolândia', type: 'setorial', dept: 'Jovens' },
        { date: '2026-08-15', title: 'Festividade Adolescentes', loc: 'Vila Cahuy', type: 'setorial', dept: 'Adolescentes' },
        { date: '2026-08-21', title: 'Evento Pérolas Setorial', loc: 'Sede', type: 'setorial', dept: 'Irmãs' },
        { date: '2026-08-22', title: 'Evento Pérolas Setorial (Enc)', loc: 'Sede', type: 'setorial', dept: 'Irmãs' },
        { date: '2026-08-28', title: 'Festividade Varões', loc: 'Guará I', type: 'setorial', dept: 'Varões' },
        { date: '2026-08-29', title: 'Festividade Irmãs', loc: 'Guará I', type: 'setorial', dept: 'Irmãs' },
        { date: '2026-08-30', title: 'Festividade Irmãs (Enc)', loc: 'Guará I', type: 'setorial', dept: 'Irmãs' },
        { date: '2026-08-31', title: 'Aniversário Pr. Walber', loc: 'Vargem Bonita', type: 'setorial', dept: 'Geral' },
        // SETEMBRO
        { date: '2026-09-03', title: 'Festividade Varões', loc: 'Guará II', type: 'setorial', dept: 'Varões' },
        { date: '2026-09-04', title: 'Festividade Irmãs', loc: 'Guará II', type: 'setorial', dept: 'Irmãs' },
        { date: '2026-09-05', title: 'Festividade Jovens', loc: 'Guará II', type: 'setorial', dept: 'Jovens' },
        { date: '2026-09-11', title: 'Festividade Primavera', loc: 'Núcleo Bandeirante', type: 'setorial', dept: 'Geral' },
        { date: '2026-09-12', title: 'Festividade Primavera (Enc)', loc: 'Núcleo Bandeirante', type: 'setorial', dept: 'Geral' },
        { date: '2026-09-25', title: 'Festividade Departamentos', loc: 'Vereda Grande', type: 'setorial', dept: 'Geral' },
        { date: '2026-09-26', title: 'Festividade Departamentos', loc: 'Park Way', type: 'setorial', dept: 'Geral' },
        // OUTUBRO
        { date: '2026-10-01', title: 'Aniversário Irmã Dinalziza', loc: 'Núcleo Bandeirante', type: 'setorial', dept: 'Irmãs' },
        { date: '2026-10-03', title: 'Pré-Congresso UDVADEB', loc: 'Sede', type: 'geral', dept: 'Varões' },
        { date: '2026-10-10', title: 'Congresso Setorial UCADEB', loc: 'Sede', type: 'setorial', dept: 'Crianças' },
        { date: '2026-10-17', title: 'Festividade UCADEB', loc: 'Guará II', type: 'setorial', dept: 'Crianças' },
        { date: '2026-10-24', title: 'SEMADEB Setorial (Cruzada)', loc: 'Sede', type: 'setorial', dept: 'Geral' },
        { date: '2026-10-27', title: 'Aniversário Pr. William', loc: 'Lúcio Costa', type: 'setorial', dept: 'Geral' },
        { date: '2026-10-30', title: 'Festividade Jovens', loc: 'Guará I', type: 'setorial', dept: 'Jovens' },
        { date: '2026-10-31', title: 'Festividade Jovens (Enc)', loc: 'Guará I', type: 'setorial', dept: 'Jovens' },
        // NOVEMBRO
        { date: '2026-11-20', title: 'Festividade Varões', loc: 'Candangolândia', type: 'setorial', dept: 'Varões' },
        { date: '2026-11-21', title: 'Festividade UCADEB (Manhã/Tarde)', loc: 'Guará I', type: 'setorial', dept: 'Crianças' },
        { date: '2026-11-21', title: 'Festividade Irmãs', loc: 'Candangolândia', type: 'setorial', dept: 'Irmãs' },
        { date: '2026-11-28', title: 'Pré-Congresso UMADEB', loc: 'Sede', type: 'geral', dept: 'Jovens' }
    ];

    // 2. FUNÇÃO RECORRENTES
    function gerarEventosRecorrentes() {
        const eventos = [];
        const inicio = new Date('2026-01-01');
        const fim = new Date('2026-12-31');
        const atual = new Date(inicio);

        while (atual <= fim) {
            const diaSemana = atual.getDay(); 
            const diaMes = atual.getDate();
            const dataStr = atual.toISOString().split('T')[0];
            const isSegundoSabado = (diaSemana === 6 && diaMes >= 8 && diaMes <= 14);

            if (isSegundoSabado) {
                eventos.push({ date: dataStr, title: 'Santa Ceia', loc: 'Candangolândia', type: 'local', dept: 'Geral', time: '19:30' });
            } else if (diaSemana === 0) { 
                eventos.push({ date: dataStr, title: 'Culto da Família', loc: 'Candangolândia', type: 'local', dept: 'Geral', time: '18:30' });
            } else if (diaSemana === 2) { 
                eventos.push({ date: dataStr, title: 'Culto de Ensino', loc: 'Candangolândia', type: 'local', dept: 'Geral', time: '19:30' });
            } else if (diaSemana === 4) { 
                eventos.push({ date: dataStr, title: 'Culto de Libertação', loc: 'Candangolândia', type: 'local', dept: 'Geral', time: '19:30' });
            }
            atual.setDate(atual.getDate() + 1);
        }
        return eventos;
    }

    // 3. FUNÇÃO EXECUTORA (Atrelada ao window)
    window.executarCarga = async function() {
        const senha = prompt("Digite a senha de Admin para RESETAR o banco:");
        if (senha !== "1234") return alert("Senha incorreta.");
        
        if (!confirm("⚠️ ATENÇÃO: Isso vai APAGAR TODOS os eventos atuais e recriar a agenda de 2026 do zero. Continuar?")) return;

        try {
            document.body.style.cursor = "wait";
            console.log("Apagando eventos antigos...");
            
            // Apaga coleção antiga
            const snapshot = await getDocs(collection(db, "eventos"));
            const deleteBatch = writeBatch(db);
            snapshot.forEach((doc) => deleteBatch.delete(doc.ref));
            await deleteBatch.commit();

            // Gera novos
            const recorrentes = gerarEventosRecorrentes();
            const todosEventos = [...eventosPDF, ...recorrentes];
            console.log(`Inserindo ${todosEventos.length} novos eventos...`);

            // Insere em lotes
            let batch = writeBatch(db);
            let count = 0;
            const total = todosEventos.length;

            for (let i = 0; i < total; i++) {
                const ev = todosEventos[i];
                const ref = doc(collection(db, "eventos"));
                batch.set(ref, {
                    title: ev.title, date: ev.date, location: ev.loc,
                    type: ev.type, departamento: ev.dept, time: ev.time || '19:30',
                    createdAt: new Date()
                });
                count++;
                if (count >= 400 || i === total - 1) {
                    await batch.commit();
                    batch = writeBatch(db);
                    count = 0;
                }
            }

            alert("✅ Sucesso! Agenda 2026 carregada e colorida.");
            document.body.style.cursor = "default";
            window.location.reload();

        } catch (e) {
            console.error(e);
            alert("Erro: " + e.message);
            document.body.style.cursor = "default";
        }
    };
</script>
</body>

</html>